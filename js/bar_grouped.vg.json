{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": { "text": "How crowded schools are — Students per school by state, grouped by stage", "subtitle": "Mean students per school · Selected Year" },
  "data": { "url": "../data/compiled_my_basiced_districtenrolment.csv" },

  "params": [
    { "name": "YearSel", "value": 2022, "bind": { "input": "select", "options": [2017,2018,2019,2020,2021,2022], "name": " Year: " } }
  ],

  "transform": [
    { "filter": "datum.year == YearSel" },
    { "calculate": "indexof(datum.state,'W.p. ')==0 ? substring(datum.state,5) : datum.state", "as": "state_norm" }
  ],

  "mark": { "type": "bar" },
  

  "encoding": {
    "y": { "field": "state_norm", "type": "nominal", "title": "States & Federal Territories", "sort": "-x", "axis": { "labelLimit": 180, "labelPadding": 4 } },
    "yOffset": { "field": "stage" },
    "x": { "aggregate": "mean", "field": "students_per_school", "type": "quantitative", "title": "Students per school (mean)" },
    "color": {
      "field": "stage", "type": "nominal", "title": "Stage",
      "scale": { "domain": ["primary","secondary"], "range": ["#4e79a7","#f28e2b"] }
    },
    "tooltip": [
      { "field": "state_norm", "title": "State" },
      { "field": "stage", "title": "Stage" },
      { "aggregate": "mean", "field": "students_per_school", "title": "Per school (mean)", "format": ".1f" },
      { "field": "schools", "title": "Schools" },
      { "field": "students", "title": "Students" }
    ]
  },

  "width": 720,
  "height": { "step": 20 },

  "config": { "view": { "stroke": null } }
}
